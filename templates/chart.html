{% extends "base.html" %}
{% block head %}
    {{ super() }}
    <script src="/static/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@^3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <style>
        #priceChart {
            border: 1px solid #cccccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
{% endblock %}
{% block content %}
    <h2 class="text-2xl font-bold mb-4">Chart</h2>
    <label for="token-select" class="block text-lg font-medium text-gray-700">Traders:</label>
    <select id="token-select"
            name="token-select"
            onchange="updateChart()"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
        <option value="">Select trade</option>
        <option value="create-new-trader">...Create new trade</option>
    </select>
    <div id="chart-container" class="mt-6">
        <canvas id="priceChart"
                width="400"
                height="200"
                class="w-full"
                style="display:none"></canvas>
    </div>
    <div class="mt-4 text-center" id="price-container" style="display:none">
        <span id="current-price" class="text-xl font-bold"></span>
    </div>
    <div class="mt-4 flex flex-col items-center space-y-4"
         id="buttons-container"
         style="display:none">
        <label for="amount" class="block text-lg font-medium text-gray-700">Amount:</label>
        <input type="number"
               id="amount"
               name="amount"
               class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
               placeholder="Enter amount" />
        <input type="number"
               id="current-price-value"
               name="current-price-value"
               class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
               placeholder="Enter amount"
               style="display:none" />
        <div class="w-full flex justify-between">
            <button id="buy-button"
                    class="w-full px-4 py-2 mr-1 bg-green-500 text-white font-semibold rounded hover:bg-green-600 transition"
                    hx-post="/api/v1/orders/buy"
                    hx-ext='json-enc'
                    hx-include="#amount, #token-select, #current-price-value"
                    hx-target="#message">BUY</button>
        </div>
        <div id="message" class="mt-4 text-center"></div>
        <div id="total-profit" class="mt-4 text-xl font-bold text-center">Total Profit: $0.00</div>
        <table class="min-w-full bg-white border border-gray-300">
            <thead>
                <tr>
                    <th class="border-b-2 px-4 py-2">Date</th>
                    <th class="border-b-2 px-4 py-2">Token</th>
                    <th class="border-b-2 px-4 py-2">Amount</th>
                    <th class="border-b-2 px-4 py-2">Price</th>
                    <th class="border-b-2 px-4 py-2">Profit</th>
                    <th class="border-b-2 px-4 py-2">Action</th>
                </tr>
            </thead>
            <tbody id="data-body">
            </tbody>
        </table>
    </div>
{% endblock %}
